<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:gc="http://xmlns.jcp.org/jsf/composite/gc">

    <ui:composition template="../template/template.xhtml">

        <ui:define name="content">
            <h:form id="idForm" class="form-horizontal">
                <h:messages />
                <script>
                    function confirmar2() {
                        $(".confirmacion2").modal('show');
                    }
                    function confirmar3() {
                        $(".confirmacion3").modal('show');
                    }
                </script>
                <gc:confirmSubmit classGC="confirmacion2" bean="#{registroController.guardarVersion()}" mensaje="Está seguro que desea generar una nueva version del expediente?"/>
                <gc:confirmSubmit classGC="confirmacion3" bean="#{registroController.concluir()}" mensaje="Está seguro que desea concluir la etapa?"/>
                <gc:confirmSubmit bean="#{registroController.guardarBorrador()}" />
                <table style="width: 100%">
                    <tr>
                        <td colspan="2">
                            <div class="panel panel-featured-top-primary">
                                <div class="panel-body" >
                                    <table style="width: 100%">
                                        <tr>
                                            <td colspan="2">
                                                <span style="font-size: 2em" class="text-resalt-primary">Expediente: #{registroController.expediente.numero}</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <br/>
                                                <table style="width: 90%">
                                                    <tr>
                                                        <td style="width: 10%">
                                                            <span class="text-primary" style="font-size: 1.5em">Etapa:</span>
                                                        </td>
                                                        <td>
                                                            <div class="btn-group btn-group-justified" role="group" style="width: 50%">
                                                                <div class="btn-group" role="group">
                                                                    <a jsf:action="#{registroController.cargarExpedienteEtapa(1)}" class="btn #{registroController.etapaEstado.verEtapa == 1? 'btn-warning' : 'btn-default'}">
                                                                        <c:choose>
                                                                            <c:when test="${registroController.etapaEstado.verEtapa == 1}">
                                                                                <span class="glyphicon glyphicon-paperclip" style="font-size: large; color: black"/>&#160;&#160;&#160;&#160;Calificación
                                                                            </c:when>
                                                                            <c:otherwise>
                                                                                Calificación
                                                                            </c:otherwise>
                                                                        </c:choose>

                                                                    </a>
                                                                </div>
                                                                <div class="btn-group" role="group">
                                                                    <a jsf:action="#{registroController.cargarExpedienteEtapa(2)}" type="button" class="btn #{registroController.etapaEstado.verEtapa == 2? 'btn-warning' : 'btn-default'}">
                                                                        <c:choose>
                                                                            <c:when test="${registroController.etapaEstado.verEtapa == 2}">
                                                                                <span class="glyphicon glyphicon-paperclip" style="font-size: large; color: black"/>&#160;&#160;&#160;&#160;Investigación
                                                                            </c:when>
                                                                            <c:otherwise>
                                                                                Investigación
                                                                            </c:otherwise>
                                                                        </c:choose>
                                                                    </a>
                                                                </div>
                                                                <div class="btn-group" role="group">
                                                                    <a jsf:action="#{registroController.cargarExpedienteEtapa(3)}" type="button" class="btn #{registroController.etapaEstado.verEtapa == 3? 'btn-warning' : 'btn-default'}">
                                                                        <c:choose>
                                                                            <c:when test="${registroController.etapaEstado.verEtapa == 3}">
                                                                                <span class="glyphicon glyphicon-paperclip" style="font-size: large; color: black"/>&#160;&#160;&#160;&#160;Persuasión
                                                                            </c:when>
                                                                            <c:otherwise>
                                                                                Persuasión
                                                                            </c:otherwise>
                                                                        </c:choose>
                                                                    </a>
                                                                </div>
                                                                <div class="btn-group" role="group">
                                                                    <a jsf:action="#{registroController.cargarExpedienteEtapa(1)}" type="button" class="btn #{registroController.etapaEstado.verEtapa == 4? 'btn-warning' : 'btn-default'}">
                                                                        <c:choose>
                                                                            <c:when test="${registroController.etapaEstado.verEtapa == 4}">
                                                                                <span class="glyphicon glyphicon-paperclip" style="font-size: large; color: black"/>&#160;&#160;&#160;&#160;Seguimiento
                                                                            </c:when>
                                                                            <c:otherwise>
                                                                                Seguimiento
                                                                            </c:otherwise>
                                                                        </c:choose>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <table style="width: 90%">
                                                <tr>
                                                    <td style="width: 25%">
                                                        <h:outputText rendered="#{registroController.etapaEstado.verEtapa != 0 and registroController.etapaEstado.verEtapa != null}" value="Estado:" class="text-primary" style="font-size: 1.5em"/>
                                                    </td>
                                                    <td>
                                                        <div class="panel-body">
                                                            <h:selectOneRadio rendered="#{registroController.etapaEstado.verEtapa == 1}"  value="#{registroController.expediente.estadoCalificacion}">
                                                                <f:selectItems value="#{registroController.listaEstadoCalificacion}"  />
                                                            </h:selectOneRadio>

                                                            <h:selectOneRadio rendered="#{registroController.etapaEstado.verEtapa == 2}"  value="#{registroController.expediente.estadoInvestigacion}">
                                                                <f:selectItems value="#{registroController.listaEstadoInvestigacion}"  />
                                                            </h:selectOneRadio>

                                                            <h:selectOneRadio rendered="#{registroController.etapaEstado.verEtapa == 3}"  value="#{registroController.expediente.estadoPersuacion}">
                                                                <f:selectItems value="#{registroController.listaEstadoPersuacion}"  />
                                                            </h:selectOneRadio>

                                                            <h:selectOneRadio rendered="#{registroController.etapaEstado.verEtapa == 4}"  value="#{registroController.expediente.estadoSeguimiento}">
                                                                <f:selectItems value="#{registroController.listaEstadoSeguimiento}"  />
                                                            </h:selectOneRadio>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>

                                                        <input type="hidden" id="idTipoClasificacion" jsf:value="#{registroController.expediente.tipoClasificion}" />
                                                        <span style="font-size: 2.5em" class="text-resalt-primary">Atención de Casos</span><br/>
                                                        <span id="idTextTipoClasificacion" class="text-resalt-comun" style="font-weight: bold;font-size: 1.5em">SELECCIONE</span>
                                                        <a href="#" class="trigger2">
                                                            <span style="color:#3183b9;font-size:large;vertical-align: top" class="glyphicon glyphicon-chevron-down trigger2"></span>
                                                        </a>
                                                        <div class="popover-markup" style="float:right">
                                                            <div class="head hide"><b class="text-primary">Seleccione</b></div>
                                                            <div class="content hide">
                                                                <div style="width:100%">
                                                                    <c:forEach var="x" items="#{listasComunesController.buscarExpedienteTipoClasificacion(false,false,false)}">
                                                                        <a class="alink" onclick="asignarTipo('${x.valorParametro}')">
                                                                            <div class="alert fade in alert-danger" role="alert" style="padding-bottom:5px;padding-top:5px;margin-bottom:3px">
                                                                                <strong>
                                                                                    <h:outputText value="${x.nombreParametro}" class="cTipoRegistro" style="cursor:pointer"/>
                                                                                </strong>
                                                                            </div>
                                                                        </a>
                                                                    </c:forEach>


                                                                </div>
                                                            </div>
                                                        </div>
                                                        <style>.alink:hover{text-decoration:none}.alink:link{text-decoration:none}.alink:active{text-decoration:none}</style>
                                                        <script>$('.trigger2').popover({html: true, placement: 'bottom', tabindex: '0', trigger: 'focus', title: function () {
                                                                    return $(this).parent().find('.head').html();
                                                                }, content: function () {
                                                                    return $(this).parent().find('.content').html();
                                                                }});
                                                            function asignarTipo(tipo) {
                                                                $("#idTipoClasificacion").val(tipo);
                                                                $("#idTextTipoClasificacion").css("color", "#3071A9");
                                                                if (tipo === "01") {
                                                                    $("#idTextTipoClasificacion").text("QUEJA");

                                                                }
                                                                if (tipo === "02") {
                                                                    $("#idTextTipoClasificacion").text("CONSULTA");

                                                                }
                                                                if (tipo === "03") {
                                                                    $("#idTextTipoClasificacion").text("PETITORIO");

                                                                }
                                                                if (tipo === "04") {
                                                                    $("#idTextTipoClasificacion").text("SIN CLASIFICACION");

                                                                }
                                                            }
                                                            if ($("#idTipoRegistro").val() !== "") {
                                                                if ($("#idTipoClasificacion").val() === "01") {
                                                                    $("#idTextTipoClasificacion").text("QUEJA");

                                                                }
                                                                if ($("#idTipoClasificacion").val() === "02") {
                                                                    $("#idTextTipoClasificacion").text("CONSULTA");

                                                                }
                                                                if ($("#idTipoClasificacion").val() === "03") {
                                                                    $("#idTextTipoClasificacion").text("PETITORIO");

                                                                }
                                                                if ($("#idTipoClasificacion").val() === "04") {
                                                                    $("#idTextTipoClasificacion").text("SIN CLASIFICACION");

                                                                }
                                                                $("#idTextTipoClasificacion").css("color", "#3071A9");
                                                            }
                                                            $(document).ready(function () {
                                                                if ($("#idTipoRegistro").val() !== "") {
                                                                    if ($("#idTipoClasificacion").val() === "01") {
                                                                        $("#idTextTipoClasificacion").text("QUEJA");

                                                                    }
                                                                    if ($("#idTipoClasificacion").val() === "02") {
                                                                        $("#idTextTipoClasificacion").text("CONSULTA");

                                                                    }
                                                                    if ($("#idTipoClasificacion").val() === "03") {
                                                                        $("#idTextTipoClasificacion").text("PETITORIO");

                                                                    }
                                                                    if ($("#idTipoClasificacion").val() === "04") {
                                                                        $("#idTextTipoClasificacion").text("SIN CLASIFICACION");

                                                                    }
                                                                    $("#idTextTipoClasificacion").css("color", "#3071A9");
                                                                }
                                                            });</script>
                                                    </td>
                                                    <td style="text-align: right">
                                                        <h:panelGroup  id="idPanel3" rendered="#{registroController.expediente.id == null || registroController.expediente.version == 0}">
                                                            <a class="btn btn-info" onclick="confirmar()">
                                                                <span class="glyphicon glyphicon-floppy-disk" />Borrador
                                                            </a>
                                                        </h:panelGroup>
                                                        &#160;&#160;
                                                        <h:panelGroup rendered="#{registroController.expediente.general != 'C'}">
                                                            <a class="btn btn-primary" onclick="confirmar2()">
                                                                <span class="glyphicon glyphicon-floppy-disk" />Guardar
                                                            </a>
                                                        </h:panelGroup>
                                                        &#160;&#160;
                                                        <h:panelGroup id="idPanel2" rendered="#{registroController.expediente.id != null and registroController.expediente.version > 0 and registroController.expediente.general != 'C'}">
                                                            <a class="btn btn-warning" onclick="confirmar3()">
                                                                <span class="glyphicon glyphicon-floppy-save" />Concluir Etapa
                                                            </a>
                                                        </h:panelGroup>
                                                    </td>
                                                </tr>
                                            </table>
                                        </tr>
                                    </table>

                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                <table style="width: 100%">
                    <tr>
                        <td style="width: 50%; vertical-align: top; padding-right: 2px">
                            <div class="panel panel-featured-top-primary" id="idPanel1">
                                <div class="panel-body" >
                                    <span class="text-resalt-primary">Información de ingreso y clasificación temática</span>
                                    <br/><br/>
                                    <table style="width: 100%">
                                        <tr>
                                            <td style="width: 50%;padding-bottom: 10px">
                                            </td>
                                            <td style="width: 50%; text-align: right">
                                                <h:selectBooleanCheckbox id="idCheckbox" value="#{registroController.expediente.calificacion}" />Calificación aprobada
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-bottom: 10px">
                                                <table style="width: 100%">
                                                    <tr>
                                                        <td style="width: 40%">
                                                            fecha de Ingreso:
                                                        </td>
                                                        <td>
                                                            <gc:calendar value="#{registroController.expediente.fechaIngreso}" />
                                                        </td>
                                                    </tr> 
                                                </table>
                                            </td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td style="padding-bottom: 30px">
                                                <h:selectOneMenu value="#{registroController.expediente.tipoIngreso}">
                                                    <f:selectItems value="#{listasComunesController.buscarExpedienteTipoIngreso(false,false,false)}" var="y" itemLabel="#{y.nombreParametro}" itemValue="#{y.valorParametro}" />
                                                </h:selectOneMenu>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </table>
                                    <span class="text-resalt-primary">Clasificación temática</span>
                                    <br/>

                                    <script>
                                        $(function () {
                                        #{registroController.cadenaEtiquetaAutocomplete}
                                            $("#etiqueta").autocomplete({
                                                minLength: 3,
                                                source: projects,
                                                focus: function (event, ui) {
                                                    $("#etiqueta").val(ui.item.label);
                                                    return false;
                                                },
                                                select: function (event, ui) {
                                                    $("#etiqueta").val(ui.item.label);
                                                    $("#idEtiqueta").val(ui.item.value);

                                                    return false;
                                                }
                                            })
                                                    .data("ui-autocomplete")._renderItem = function (ul, item) {
                                                return $("<li/>")
                                                        .append("<a>" + item.label + "<br/>" + item.desc + "</a>")
                                                        .appendTo(ul);
                                            };

                                        });
                                    </script>
                                    <table style="width: 80%">
                                        <tr>
                                            <td colspan="2">
                                                <h:selectOneMenu value="#{registroController.expediente.tipoTema}" onchange="loadingModal()">
                                                    <f:selectItem itemValue="0" itemLabel="Tema" />
                                                    <f:selectItems value="#{listasComunesController.buscarExpedienteTema(false,false,false)}" var="y" itemLabel="#{y.nombreParametro}" itemValue="#{y.valorParametro}" />
                                                    <f:ajax listener="#{registroController.cargarSubTemas()}"  render="idSelectSubTema" onevent="closeModal"/>
                                                </h:selectOneMenu>
                                                <br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <h:selectOneMenu id="idSelectSubTema" value="#{registroController.expediente.tipoSubtema}">
                                                    <f:selectItem itemValue="0" itemLabel="Sub tema" />
                                                    <f:selectItems value="#{registroController.listaSubTemas}" var="y" itemLabel="#{y.nombreParametro}" itemValue="#{y.valorParametro}" />
                                                </h:selectOneMenu>
                                                <br/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Etiquetas:</td>
                                            <td>
                                                <h:panelGroup id="idPanelEtiqueta">
                                                    <h:messages />
                                                <div class="form-group has-feedback" style="margin: auto">
                                                    <input type="text" id="etiqueta" jsf:value="#{registroController.expediente.nombreEtiqueta}" placeholder="Ingrese Etiqueta"/>
                                                    <input type="text" id="idEtiqueta" jsf:value="#{registroController.expediente.idEtiqueta}" />
                                                    <a jsf:action="#{registroController.agregarEtiqueta()}">
                                                        <span class="glyphicon glyphicon-plus form-control-feedback"/>
                                                        <f:ajax render="idPanelEtiqueta"  />
                                                    </a>
                                                </div>
                                                    </h:panelGroup>
                                                <br/>
                                            </td>
                                        </tr>
                                    </table>

                                    <div class="row" style="padding: 20px">
                                        <c:forEach var="x" items="#{registroController.listaEtiquetasSeleccionadas}">
                                            <div class="col-md-4 alert alert-info fade in" style="border-color: #007ACC; margin-bottom: 3px">
                                                <table style="width: 100%">
                                                    <tr>
                                                        <td>
                                                            <h:outputText style="font-weight: bold" value="#{x.nombreParametro}" />
                                                        </td>
                                                        <td style="text-align: right">
                                                            <a jsf:action="#{registroController.removeEtiqueta(x)}" jsf:onclick="loadingModal()">
                                                                <span class="glyphicon glyphicon-remove"  style="color: red"/>
                                                                <f:ajax render="@form" onevent="closeModal" />
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </table>    
                                            </div>             
                                        </c:forEach>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="vertical-align: top;  padding-left: 2px;">

                            <div id="idPanel2" class="panel panel-featured-top-primary">
                                <div class="panel-body">
                                    <span class="text-resalt-primary">Sumilla</span>
                                    <textarea rows="3" jsf:value="#{registroController.expediente.sumilla}" style="width: 100%; height: 170px" placeholder="Sumilla"/>
                                    <br/>
                                    <span class="text-resalt-primary">Observaciones</span>
                                    <textarea rows="3" jsf:value="#{registroController.expediente.observacion}" style="width: 100%; height: 170px" placeholder="Observacion"/>
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <script>
                            $(document).ready(function () {
                                if (parseInt($("#idPanel3").height()) > parseInt($("#idPanel4").height())) {
                                    $("#idPanel4").css("height", ($("#idPanel3").height() + 4) + "px");
                                } else {
                                    $("#idPanel3").css("height", ($("#idPanel4").height() + 4) + "px");
                                }
                                var altura = $("#idPanel1").height();
                                $("#idPanel2").css("height", (altura + 4) + "px");
                            });
                        </script>
                        <td style="vertical-align: top; padding-right: 2px; text-align: left">
                            <span class="text-resalt-primary">Recurrentes y afectados</span>
                            <div class="panel panel-featured-top-primary" id="idPanel3">
                                <div class="panel-body">
                                    <table style="width: 100%">
                                        <tr>
                                            <td style="width: 60%">
                                                <input type="text" name="nombreActor" style="width: 100%" placeholder="Ingrese nombre/DNI de la persona" jsf:value="#{registroController.cadenaPersonaPopover}"/>
                                            </td>
                                            <td>
                                                <a href="#" class="trigger" jsf:action="#{registroController.cargarPopoverPersona()}" jsf:onclick="loadingModal()">
                                                    <span style="color: #3183B9; font-size: large;" class="glyphicon glyphicon-search"></span>
                                                    <f:ajax render="idForm:idPanel" execute="@form" onevent="popove"/>
                                                </a>
                                                <div class="popover-markup" id="idPopover0" style="float: right"> 
                                                    <div class="head hide ">
                                                        <b class="text-primary">Resultado de la busqueda</b>
                                                    </div>
                                                    <h:panelGroup id="idPanel">
                                                        <div class="content hide">
                                                            <h:dataTable value="#{registroController.personasPopover}" var="personas" class="table table-hover" style="width: 100%">
                                                                <h:column>
                                                                    <f:facet name="header">Nombre</f:facet>
                                                                    <h:outputText value="#{personas.nombre} #{personas.apellidoPat} #{personas.apellidoMat}"/>
                                                                </h:column>
                                                                <h:column>
                                                                    <f:facet name="header">DNI</f:facet>
                                                                    <h:outputText value="#{personas.dni}"/>
                                                                </h:column>
                                                                <h:column>
                                                                    <a jsf:action="#{registroController.addPersona(personas)}" jsf:onclick="loadingModal()">
                                                                        <span style="font-size: large" class="glyphicon glyphicon-log-out"></span>  
                                                                        <f:ajax render="@form" onevent="closeModal"/>
                                                                    </a>
                                                                </h:column>
                                                            </h:dataTable>
                                                        </div>

                                                        <style>
                                                            .alink:hover {
                                                                text-decoration: none;
                                                            }
                                                            .alink:link {
                                                                text-decoration: none;
                                                            }

                                                            .alink:active {
                                                                text-decoration: none;
                                                            }
                                                        </style>
                                                        <script>
                                                            $('body').click(function () {
                                                                $('.trigger').popover('destroy');
                                                            });

                                                            var i = 0;
                                                            function popove(data) {
                                                                if (data.status === 'success') {
                                                                    i++;
                                                                    $('.trigger').popover({
                                                                        html: true,
                                                                        placement: 'bottom',
                                                                        tabindex: '0',
                                                                        trigger: 'focus',
                                                                        title: function () {
                                                                            return $(this).parent().find('.head').html();
                                                                        },
                                                                        content: function () {
                                                                            return $(this).parent().find('.content').html();
                                                                        }
                                                                    });

                                                                    if (i === 1) {
                                                                        $('.trigger').popover('show');
                                                                    }
                                                                    $("#loadModal").modal('hide');
                                                                    $('body').removeClass('modal-open');
                                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                                }
                                                            }
                                                        </script> 
                                                    </h:panelGroup>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <h:dataTable value="#{registroController.personasSeleccionadas}" var="persona" class="table table-striped" binding="#{item}" rendered="#{registroController.personasSeleccionadas.size() > 0}">
                                                    <h:column>
                                                        <f:facet name="header">Nro</f:facet>
                                                        <h:outputText value="#{item.rowIndex+1}" />
                                                    </h:column>
                                                    <h:column>
                                                        <f:facet name="header">Nombre</f:facet>
                                                        <h:outputText value="#{persona.persona.nombre} #{persona.persona.apellidoPat} #{persona.persona.apellidoMat}"/>
                                                    </h:column>
                                                    <h:column>
                                                        <f:facet name="header">DNI</f:facet>
                                                        <h:outputText value="#{persona.persona.dni}"/>
                                                    </h:column>
                                                    <h:column>
                                                        <h:selectOneMenu value="#{persona.cargo}">
                                                            <f:selectItems value="#{listasComunesController.buscarExpedienteTipoActor(false,false,false)}" var="y" itemLabel="#{y.nombreParametro}" itemValue="#{y.valorParametro}" />
                                                        </h:selectOneMenu>
                                                    </h:column>
                                                    <h:column>
                                                        <script>
                                                            function confirmar4#{item.rowIndex+1}() {
                                                                $(".confirmacion4#{item.rowIndex+1}").modal('show');
                                                            }
                                                        </script>
                                                        <gc:confirmAjax bean="#{registroController.removePersona(persona)}" classGC="confirmacion4#{item.rowIndex+1}" mensaje="Esta seguro de desvincular a la Persona?" />

                                                        <a onclick="confirmar4#{item.rowIndex+1}()">
                                                            <span style="font-size: large; color: red" class="glyphicon glyphicon-remove"></span>
                                                        </a>
                                                    </h:column>
                                                </h:dataTable>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </td>
                        <td style="vertical-align: top; padding-left: 2px">
                            <span class="text-resalt-primary">Entidad Quejada</span>
                            <div class="panel panel-featured-top-primary" id="idPanel4">
                                <div class="panel-body">
                                    <table style="width: 100%">
                                        <tr>
                                            <td style="width: 60%">
                                                <input type="text" style="width: 100%" placeholder="Ingrese nombre o RUC de la Entidad" jsf:value="#{registroController.cadenaEntidadPopover}"/>
                                            </td>
                                            <td>
                                                <a href="#" class="trigger1" jsf:action="#{registroController.cargarPopoverEntidad()}" jsf:onclick="loadingModal()">
                                                    <span style="color: #3183B9; font-size: large;" class="glyphicon glyphicon-search"></span>
                                                    <f:ajax render="idForm:idPanel1" execute="@form" onevent="popove1"/>
                                                </a>
                                                <div class="popover-markup" style="float: right"> 
                                                    <div class="head hide ">
                                                        <table style="width: 100%">
                                                            <tr>
                                                                <td>
                                                                    <b class="text-primary">Resultado de la busqueda</b>
                                                                </td>
                                                                <td style="text-align: right">

                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                    <h:panelGroup id="idPanel1">
                                                        <div class="content hide">
                                                            <h:dataTable value="#{registroController.entidadPopover}" var="entidades" class="table table-hover">
                                                                <h:column>
                                                                    <f:facet name="header">Nombre</f:facet>
                                                                    <h:outputText value="#{entidades.nombre}"/>
                                                                </h:column>
                                                                <h:column>
                                                                    <f:facet name="header">RUC</f:facet>
                                                                    <h:outputText value="#{entidades.ruc}"/>
                                                                </h:column>
                                                                <h:column>
                                                                    <a jsf:action="#{registroController.addEntidad(entidades)}" jsf:onclick="loadingModal()">
                                                                        <span style="font-size: large" class="glyphicon glyphicon-log-out"></span>  
                                                                        <f:ajax render="@form" onevent="closeModal"/>
                                                                    </a>
                                                                </h:column>
                                                            </h:dataTable>
                                                        </div>

                                                        <style>
                                                            .alink:hover {
                                                                text-decoration: none;
                                                            }
                                                            .alink:link {
                                                                text-decoration: none;
                                                            }

                                                            .alink:active {
                                                                text-decoration: none;
                                                            }
                                                        </style>
                                                        <script>
                                                            $('body').click(function () {
                                                                $('.trigger1').popover('destroy');
                                                            });

                                                            var i = 0;
                                                            function popove1(data) {
                                                                if (data.status === 'success') {
                                                                    i++;
                                                                    $('.trigger1').popover({
                                                                        html: true,
                                                                        placement: 'bottom',
                                                                        tabindex: '0',
                                                                        trigger: 'focus',
                                                                        title: function () {
                                                                            return $(this).parent().find('.head').html();
                                                                        },
                                                                        content: function () {
                                                                            return $(this).parent().find('.content').html();
                                                                        }
                                                                    });

                                                                    if (i === 1) {
                                                                        $('.trigger1').popover('show');
                                                                    }
                                                                    $("#loadModal").modal('hide');
                                                                    $('body').removeClass('modal-open');
                                                                    $(".modal-backdrop").removeClass("modal-backdrop");
                                                                }
                                                            }
                                                        </script> 
                                                    </h:panelGroup>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <h:dataTable value="#{registroController.entidadSeleccionadas}" var="entidad" class="table table-striped" binding="#{item1}" rendered="#{registroController.entidadSeleccionadas.size() > 0}">
                                                    <h:column>
                                                        <f:facet name="header">Nro</f:facet>
                                                        <h:outputText value="#{item1.rowIndex+1}" />
                                                    </h:column>
                                                    <h:column>
                                                        <f:facet name="header">Nombre</f:facet>
                                                        <h:outputText value="#{entidad.entidad.nombre}"/>
                                                    </h:column>
                                                    <h:column>
                                                        <f:facet name="header">RUC</f:facet>
                                                        <h:outputText value="#{entidad.entidad.ruc}"/>
                                                    </h:column>
                                                    <h:column>
                                                        <script>
                                                            function confirmar3#{item1.rowIndex+1}() {
                                                                $(".confirmacion3#{item1.rowIndex+1}").modal('show');
                                                            }
                                                        </script>
                                                        <gc:confirmAjax bean="#{registroController.removeEntidad(entidad)}" classGC="confirmacion3#{item1.rowIndex+1}" mensaje="Esta seguro de desvincular la Entidad?" />
                                                        <a onclick="confirmar3#{item1.rowIndex+1}()">
                                                            <span style="font-size: large; color: red" class="glyphicon glyphicon-remove"></span>
                                                        </a>
                                                    </h:column>
                                                </h:dataTable>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td style="vertical-align: top; padding-right: 2px">
                            <span class="text-resalt-primary">Preguntas de clasificación del caso</span>
                            <div class="panel panel-featured-top-primary" style="height: 200px">
                                <div class="panel-body">

                                </div>
                            </div>
                        </td>
                        <td style="vertical-align: top; padding-left: 2px">
                            <span class="text-resalt-primary">Admisión</span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <span class="text-resalt-primary">Responsables del caso</span>
                            <div class="panel panel-featured-top-primary" style="height: 100px">
                                <div class="panel-body">
                                    <span class="text-resalt-primary"><b>#{registroController.usuarioSession.nombre} #{registroController.usuarioSession.apellidoPaterno} #{registroController.usuarioSession.apellidoMaterno} - #{registroController.usuarioSession.cargo}</b></span>
                                </div>
                            </div>
                        </td>                    
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center">

                        </td>
                    </tr>
                </table>
            </h:form>
        </ui:define>
    </ui:composition>
</html>            
