<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD iBatis Mapper 3.0 //EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="gob.dp.sid.registro.dao.ExpedienteGestionDAO">
    
    <resultMap id="expedienteGestionMap" type="expedienteGestion">
        <id property="id" column="N_ID_GESTION" />
        <result property="codigoGestion" column="C_CODIGOGESTION"/>
        <result property="tipo" column="C_TIPO"/>
        <result property="fecha" column="D_FECHA"/>
        <result property="descripcion" column="C_DESCRIPCION"/>
        <result property="institucion" column="C_INSTITUCION"/>
        <result property="indEntidadQuejada" column="C_INDENTQUEJADA"/>
        <result property="nombre" column="C_NOMBREFUNC"/>
        <result property="apellidoPaterno" column="C_APEPATFUNC"/>
        <result property="apellidoMaterno" column="C_APEMATFUNC"/>
        <result property="indAlertar" column="C_INDALERTAR"/>
        <result property="inicioSeguimiento" column="D_FECINISEGUIMIENTO" />
        <result property="finSeguimiento" column="D_FECFINSEGUIMIENTO"/>
        <result property="tipoTiempoIni" column="C_INDTIPOTIEMPOINI"/>
        <result property="tipoTiempoFin" column="C_INDTIPOTIEMPOFIN"/>
        <result property="numeroInicial" column="N_NUMEROTIEMPOINI"/>
        <result property="numeroFinal" column="N_NUMEROTIEMPOFIN"/>
        <result property="indicadorAntesDespuesIni" column="C_INDANTESDESPUESINI"/>
        <result property="indicadorAntesDespuesFin" column="C_INDANTESDESPUESFIN"/>
        <result property="inicioDefinitivo" column="D_FECINISEGUIMIENTOFINAL"/>
        <result property="finDefinitivo" column="D_FECFINSEGUIMIENTOFINAL"/>
        <result property="indiceRepeticion" column="C_INDREPETICION"/>
        <result property="indicadorSeleccionHoraIni" column="C_INDSELECCIONHORAINI"/>
        <result property="indicadorSeleccionHoraFin" column="C_INDSELECCIONHORAFIN"/>
        <result property="nota" column="C_NOTA"/>
        <result property="respuesta" column="C_RESPUESTA"/>
        <result property="fechaRespuesta" column="D_FECHARESPUESTA"/>
        <result property="tipoCalidad" column="C_CALIDADRESPUESTA"/>
        <result property="detalleRespuesta" column="C_DESCRIPCIONRESPUESTA"/>
        <result property="observacionRespuesta" column="C_OBSERVACIONES"/>
        <result property="usuarioRegistro" column="C_USUREGISTRO"/>
        <result property="usuarioModificacion" column="C_USUMODIFICACION"/>
        <result property="fechaRegistro" column="D_FECHAREGISTRO"/>
        <result property="fechaModificacion" column="D_FECHAMODIFICACION"/>
        <result property="indicadorRecomendacion" column="C_INDRECOMENDACION"/>
        <result property="documentoRespuesta" column="C_DOCUMENTORESPUESTA"/>
        <result property="tipoAcogimiento" column="C_TIPOACOGIMIENTO"/>
        <result property="ruta1" column="C_RUTA1"/>
        <result property="ruta2" column="C_RUTA2"/>
        <result property="documentoGestion" column="C_DOCUMENTOGESTION"/>
        <!--adionales-->
        <result property="nombreParametroTipo" column="NOMBRE_PARAMETRO"/>
        <result property="idEtapa" column="N_ID_ETAPA"/>
        <result property="detalleTipo" column="GESTION_TIPO"/>
        
    </resultMap> 
    
    
    <insert id="expedienteGestionInsertar" parameterType="expedienteGestion">
        INSERT INTO SID_REG_GESTION
        (
        <if test="tipo != null">
            C_TIPO,
        </if>
        <if test="fecha != null">
            D_FECHA,
        </if>
        <if test="codigoGestion != null">
            C_CODIGOGESTION,
        </if>
        <if test="descripcion != null">
            C_DESCRIPCION,
        </if>
        <if test="indEntidadQuejada != null">
            C_INDENTQUEJADA,
        </if>
        <if test="nombre != null">
            C_NOMBREFUNC,
        </if>
        <if test="apellidoPaterno != null">
            C_APEPATFUNC,
        </if>
        <if test="apellidoMaterno != null">
            C_APEMATFUNC,
        </if>
        <if test="institucion != null">
            C_INSTITUCION,
        </if>
        <if test="indAlertar != null">
            C_INDALERTAR,
        </if>
        <if test="inicioSeguimiento != null">
            D_FECINISEGUIMIENTO,
        </if>
        <if test="finSeguimiento != null">
            D_FECFINSEGUIMIENTO,
        </if>
        <if test="tipoTiempoIni != null">
            C_INDTIPOTIEMPOINI,
        </if>
        <if test="tipoTiempoFin != null">
            C_INDTIPOTIEMPOFIN,
        </if>
        <if test="numeroInicial != null">
            N_NUMEROTIEMPOINI,
        </if>
        <if test="numeroFinal != null">
            N_NUMEROTIEMPOFIN,
        </if>
        <if test="indicadorAntesDespuesIni != null">
            C_INDANTESDESPUESINI,
        </if>
        <if test="indicadorAntesDespuesFin != null">
            C_INDANTESDESPUESFIN,
        </if>
        <if test="inicioDefinitivo != null">
            D_FECINISEGUIMIENTOFINAL,
        </if>
        <if test="finDefinitivo != null">
            D_FECFINSEGUIMIENTOFINAL,
        </if>
        <if test="indiceRepeticion != null">
            C_INDREPETICION,
        </if>
        <if test="indicadorSeleccionHoraIni != null">
            C_INDSELECCIONHORAINI,
        </if>
        <if test="indicadorSeleccionHoraFin != null">
            C_INDSELECCIONHORAFIN,
        </if>
        <if test="nota != null">
            C_NOTA,
        </if>
        <if test="respuesta != null">
            C_RESPUESTA,
        </if>
        <if test="fechaRespuesta != null">
            D_FECHARESPUESTA,
        </if>
        <if test="tipoCalidad != null">
            C_CALIDADRESPUESTA,
        </if>
        <if test="detalleRespuesta != null">
            C_DESCRIPCIONRESPUESTA,
        </if>
        <if test="observacionRespuesta != null">
            C_OBSERVACIONES,
        </if>
        <if test="usuarioRegistro != null">
            C_USUREGISTRO,
        </if>
        <if test="fechaRegistro != null">
            D_FECHAREGISTRO,
        </if>
        <if test="indicadorRecomendacion != null">
            C_INDRECOMENDACION,
        </if>
        <if test="documentoRespuesta != null">
            C_DOCUMENTORESPUESTA,
        </if>
        <if test="tipoAcogimiento != null">
            C_TIPOACOGIMIENTO,
        </if>
        <if test="ruta1 != null">
            C_RUTA1,
        </if>
        <if test="ruta2 != null">
            C_RUTA2,
        </if>
        <if test="documentoGestion != null">
            C_DOCUMENTOGESTION,
        </if>
        N_ID_GESTION
        )
        VALUES 
        (
        <if test="tipo != null">
            #{tipo},
        </if>
        <if test="fecha != null">
            #{fecha},
        </if>
        <if test="codigoGestion != null">
            #{codigoGestion},
        </if>
        <if test="descripcion != null">
            #{descripcion},
        </if>
        <if test="indEntidadQuejada != null">
            #{indEntidadQuejada},
        </if>
        <if test="nombre != null">
            #{nombre},
        </if>
        <if test="apellidoPaterno != null">
            #{apellidoPaterno},
        </if>
        <if test="apellidoMaterno != null">
            #{apellidoMaterno},
        </if>
        <if test="institucion != null">
            #{institucion},
        </if>
        <if test="indAlertar != null">
            #{indAlertar},
        </if>
        <if test="inicioSeguimiento != null">
            #{inicioSeguimiento},
        </if>
        <if test="finSeguimiento != null">
            #{finSeguimiento},
        </if>
        <if test="tipoTiempoIni != null">
            #{tipoTiempoIni},
        </if>
        <if test="tipoTiempoFin != null">
            #{tipoTiempoFin},
        </if>
        <if test="numeroInicial != null">
            #{numeroInicial},
        </if>
        <if test="numeroFinal != null">
            #{numeroFinal},
        </if>
        <if test="indicadorAntesDespuesIni != null">
            #{indicadorAntesDespuesIni},
        </if>
        <if test="indicadorAntesDespuesFin != null">
            #{indicadorAntesDespuesFin},
        </if>
        <if test="inicioDefinitivo != null">
            #{inicioDefinitivo},
        </if>
        <if test="finDefinitivo != null">
            #{finDefinitivo},
        </if>
        <if test="indiceRepeticion != null">
            #{indiceRepeticion},
        </if>
        <if test="indicadorSeleccionHoraIni != null">
            #{indicadorSeleccionHoraIni},
        </if>
        <if test="indicadorSeleccionHoraFin != null">
            #{indicadorSeleccionHoraFin},
        </if>
        <if test="nota != null">
            #{nota},
        </if>
        <if test="respuesta != null">
            #{respuesta},
        </if>
        <if test="fechaRespuesta != null">
            #{fechaRespuesta},
        </if>
        <if test="tipoCalidad != null">
            #{tipoCalidad},
        </if>
        <if test="detalleRespuesta != null">
            #{detalleRespuesta},
        </if>
        <if test="observacionRespuesta != null">
            #{observacionRespuesta},
        </if>
        <if test="usuarioRegistro != null">
            #{usuarioRegistro},
        </if>
        <if test="fechaRegistro != null">
            #{fechaRegistro},
        </if>
        <if test="indicadorRecomendacion != null">
            #{indicadorRecomendacion},
        </if>
        <if test="documentoRespuesta != null">
            #{documentoRespuesta},
        </if>
        <if test="tipoAcogimiento != null">
            #{tipoAcogimiento},
        </if>
        <if test="ruta1 != null">
            #{ruta1},
        </if>
        <if test="ruta2 != null">
            #{ruta2},
        </if>
        <if test="documentoGestion != null">
            #{documentoGestion},
        </if>
        SEQ_SID_REG_GESTION.NextVal
        )
        <selectKey keyProperty="id" resultType="Long">
            SELECT SEQ_SID_REG_GESTION.CURRVAL FROM DUAL
        </selectKey>
    </insert>
    
    
    <update id="expedienteGestionUpdate" parameterType="expedienteGestion">
        UPDATE SID_REG_GESTION
        <set>
        <if test="tipo != null">
            C_TIPO = #{tipo},
        </if>
        <if test="descripcion != null">
            C_DESCRIPCION = #{descripcion},
        </if>
        <if test="indEntidadQuejada != null">
            C_INDENTQUEJADA = #{indEntidadQuejada},
        </if>
        <if test="nombre != null">
            C_NOMBREFUNC = #{nombre},
        </if>
        <if test="apellidoPaterno != null">
            C_APEPATFUNC = #{apellidoPaterno},
        </if>
        <if test="apellidoMaterno != null">
            C_APEMATFUNC = #{apellidoMaterno},
        </if>
        <if test="institucion != null">
            C_INSTITUCION = #{institucion},
        </if>
        <if test="indAlertar != null">
            C_INDALERTAR = #{indAlertar},
        </if>
        <if test="inicioSeguimiento != null">
            D_FECINISEGUIMIENTO = #{inicioSeguimiento},
        </if>
        <if test="finSeguimiento != null">
            D_FECFINSEGUIMIENTO = #{finSeguimiento},
        </if>
        <if test="tipoTiempoIni != null">
            C_INDTIPOTIEMPOINI = #{tipoTiempoIni},
        </if>
        <if test="tipoTiempoFin != null">
            C_INDTIPOTIEMPOFIN = #{tipoTiempoFin},
        </if>
        <if test="numeroInicial != null">
            N_NUMEROTIEMPOINI = #{numeroInicial},
        </if>
        <if test="numeroFinal != null">
            N_NUMEROTIEMPOFIN = #{numeroFinal},
        </if>
        <if test="indicadorAntesDespuesIni != null">
            C_INDANTESDESPUESINI = #{indicadorAntesDespuesIni},
        </if>
        <if test="indicadorAntesDespuesFin != null">
            C_INDANTESDESPUESFIN = #{indicadorAntesDespuesFin},
        </if>
        <if test="inicioDefinitivo != null">
            D_FECINISEGUIMIENTOFINAL = #{inicioDefinitivo},
        </if>
        <if test="finDefinitivo != null">
            D_FECFINSEGUIMIENTOFINAL = #{finDefinitivo},
        </if>
        <if test="indiceRepeticion != null">
            C_INDREPETICION = #{indiceRepeticion},
        </if>
        <if test="indicadorSeleccionHoraIni != null">
            C_INDSELECCIONHORAINI = #{indicadorSeleccionHoraIni},
        </if>
        <if test="indicadorSeleccionHoraFin != null">
            C_INDSELECCIONHORAFIN = #{indicadorSeleccionHoraFin},
        </if>
        <if test="nota != null">
            C_NOTA = #{nota},
        </if>
        <if test="respuesta != null">
            C_RESPUESTA = #{respuesta},
        </if>
        <if test="fechaRespuesta != null">
            D_FECHARESPUESTA = #{fechaRespuesta},
        </if>
        <if test="tipoCalidad != null">
            C_CALIDADRESPUESTA = #{tipoCalidad},
        </if>
        <if test="detalleRespuesta != null">
            C_DESCRIPCIONRESPUESTA = #{detalleRespuesta},
        </if>
        <if test="observacionRespuesta != null">
            C_OBSERVACIONES = #{observacionRespuesta},
        </if>
        <if test="indicadorRecomendacion != null">
            C_INDRECOMENDACION = #{indicadorRecomendacion},
        </if>
        <if test="documentoRespuesta != null">
            C_DOCUMENTORESPUESTA = #{documentoRespuesta},
        </if>
        <if test="tipoAcogimiento != null">
            C_TIPOACOGIMIENTO = #{tipoAcogimiento},
        </if>
        <if test="ruta1 != null">
            C_RUTA1 = #{ruta1},
        </if>
        <if test="ruta2 != null">
            C_RUTA2 = #{ruta2},
        </if>
        <if test="documentoGestion != null">
            C_DOCUMENTOGESTION = #{documentoGestion},
        </if>
        C_USUMODIFICACION = #{usuarioModificacion},
        D_FECHAMODIFICACION = #{fechaModificacion}
        </set>
        <where>
            N_ID_GESTION = #{id}
        </where>
    </update>
    
    <select id="expedienteGestionLista" resultMap="expedienteGestionMap" parameterType="Long" >
        SELECT A.*, C.NOMBRE_PARAMETRO FROM SID_REG_GESTION A
        INNER JOIN SID_REG_GESTION_ETAPA B ON A.N_ID_GESTION = B.N_ID_GESTION
        LEFT JOIN SID_PARAMETRO C ON TRIM(A.C_TIPO) = TRIM(C.VALOR_PARAMETRO) AND C.PADRE_PARAMETRO = 70
        WHERE B.N_IDEXPEDIENTE = #{id}
    </select>
    
    <select id="expedienteGestionOne" resultMap="expedienteGestionMap" parameterType="Long" >
        SELECT * FROM SID_REG_GESTION WHERE N_ID_GESTION = #{id}
    </select>
    
    
    <select id="expedienteGestionListaXexpediente" resultMap="expedienteGestionMap" parameterType="String" >
        SELECT A.*,B.N_ID_ETAPA, C.NOMBRE_PARAMETRO AS GESTION_TIPO FROM SID_REG_GESTION A
INNER JOIN SID_REG_GESTION_ETAPA B ON A.N_ID_GESTION = B.N_ID_GESTION 
LEFT JOIN SID_PARAMETRO C ON TRIM(A.C_TIPO) = TRIM(C.VALOR_PARAMETRO) 
AND C.PADRE_PARAMETRO = 70 
WHERE B.C_NUMEROEXPEDIENTE = #{value}
    </select>
    
    
</mapper>