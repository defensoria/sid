<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD iBatis Mapper 3.0 //EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="gob.dp.sid.reporte.dao.ReporteSidExpedienteDAO">
    
    <resultMap id="reporteSidExpedienteMap" type="reporteSidExpediente">
        <result property="idExpediente" column="N_IDEXPEDIENTE" />
        <result property="numeroExpediente" column="C_NUMEROEXPEDIENTE" />
        <result property="tipoExpediente" column="TIPOEXPEDIENTE" />
        <result property="fechaRegistro" column="D_FECHAREGISTRO" />
        <result property="etapaExpediente" column="ETAPAEXPEDIENTE" />
        <result property="estadoGeneral" column="C_ESTADOGENERAL" />
        <result property="sumilla" column="C_SUMILLA" />
        <result property="fechaIngreso" column="D_FECHAINGRESO" />
        <result property="nombreOD" column="OD" />
        <result property="comisionado" column="USUARIONOMBRE" />
        <result property="numeroExpediente" column="C_NUMEROEXPEDIENTE" />
        <result property="canalIngreso" column="CANALINGRESO" />
        <result property="canalIngresoDetalle" column="CANALINGRESODETALLE" />
        <result property="tipoGrupoVulnerable" column="C_TIPOGRUPOVULNERABLE"/>
        <result property="estadoCalificacion" column="ESTADOCALIFICACION"/>
        <result property="estadoInvestigacion" column="ESTADOINVESTIGACION"/>
        <result property="estadoPersuacion" column="ESTADOPERSUACION"/>
        <result property="estadoSeguimiento" column="ESTADOSEGUIMIENTO"/>
        <result property="estadoRegistro" column="ESTADOREGISTRO"/>
        <result property="etiqueta" column="C_ETIQUETA"/>
        <result property="codigoGestion" column="C_CODIGOGESTION"/>
        <result property="fechaRecepcionGestion" column="D_FECHA"/>
        <result property="entidadGestion" column="C_NOMENTIDAD"/>
        <result property="descripcionGestion" column="C_DESCRIPCION"/>
        <result property="fechaRegistroGestion" column="D_FECHAREGISTRO"/>
        <result property="fechaModificacionGestion" column="D_FECHAMODIFICACION"/>
        <result property="respuestaGestion" column="C_RESPUESTA"/>
        <result property="fechaRespuestaGestion" column="D_FECHARESPUESTA"/>
        <result property="codigoGestionOrigen" column="C_CODIGOGESTIONORIGEN"/>
    </resultMap> 
    
    <resultMap id="reporteSidConteoMap" type="reporteSidConteo">
        <result property="totalExpediente" column="TOTAL" />
        <result property="totalExpedienteQueja" column="TOTAL_QUEJA" />
        <result property="totalExpedienteQuejaTramite" column="TOTAL_QUEJA_TRAMITE" />
        <result property="totalExpedienteQuejaConcluido" column="TOTAL_QUEJA_CONCLUIDO" />
        <result property="totalExpedienteQuejaConcluidoFundado" column="TOTAL_QUEJA_CONCLUIDO_FUNDADO" />
        <result property="totalExpedienteQuejaConcluidoFundadoAcogido" column="Q_CONCLUIDO_FUNDADO_ACOGIDO" />
        <result property="totalExpedienteQuejaConcluidoFundadoAcogidoParcial" column="Q_FUNDADO_ACOGIDOPAR" />
        <result property="totalExpedienteQuejaConcluidoFundadoAcogidoParcialAcogido" column="Q_FUNDADO_ACOGIDOPAR_ACOGIDO" />
        <result property="totalExpedienteQuejaConcluidoFundadoAcogidoParcialAcogidoParcial" column="Q_FUNDA_ACOGIDOPAR_ACOGIDOPAR" />
        <result property="totalExpedienteQuejaConcluidoFundadoAcogidoParcialNoAcogido" column="Q_FUNDADO_ACOGIDOPAR_NOACOGIDO" />
        <result property="totalExpedienteQuejaConcluidoFundadoNoAcogidoAcogido" column="Q_FUNDADO_NOACOGIDOP_ACOGIDO" />
        <result property="totalExpedienteQuejaConcluidoFundadoNoAcogidoAcogidoParcial" column="Q_FUNDADO_NOACOGIDO_ACOGIDOPAR" />
        <result property="totalExpedienteQuejaConcluidoFundadoNoAcogidoNoAcogido" column="Q_FUNDADO_NOACOGIDO_NOACOGIDO" />
        <result property="totalExpedientePetitorio" column="TOTAL_PETITORIO" />
        <result property="totalExpedientePetitorioTramite" column="TOTAL_PETITORIO_TRAMITE" />
        <result property="totalExpedientePetitorioConcluido" column="TOTAL_PETITORIO_CONCLUIDO" />
        <result property="totalExpedientePetitorioConcluidoAcogido" column="TOTAL_PET_CONCLUIDO_ACO" />
        <result property="totalExpedientePetitorioConcluidoNoAcogido" column="TOTAL_PET_CONCLUIDO_NACO" />
        <result property="totalGestion" column="TOTAL_GESTION" />
        <result property="totalGestionSi" column="TOTAL_GESTION_SI" />
        <result property="totalGestionNo" column="TOTAL_GESTION_NO" />
        <result property="entidad" column="C_NOMENTIDAD" />
        <result property="departamento" column="C_DESCDPTO" />
    </resultMap> 

    <select id="listaExpedienteReporte" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
        SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
        SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, A.D_FECHAREGISTRO, C.NOMBRE_PARAMETRO CANALINGRESO, E.C_VALOR ETAPAEXPEDIENTE, F.C_NOMBRE ESTADOCALIFICACION, 
G.C_NOMBRE ESTADOINVESTIGACION, H.C_NOMBRE ESTADOPERSUACION, I.C_NOMBRE ESTADOSEGUIMIENTO, A.C_TIPOGRUPOVULNERABLE, A.C_ETIQUETA,
CASE WHEN C_ESTADOGENERAL = 'A' THEN 'Tr√°mite' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO IS NULL THEN 'Concluido' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO = 1 THEN 'Desistido' END ESTADOGENERAL,
CASE N_VERSION WHEN 0 THEN 'Borrador' ELSE 'En registro' END ESTADOREGISTRO, A.C_SUMILLA, J.C_NOMBRE OD, A.D_FECHAINGRESO, A.C_USUREGISTRO, K.NOM_USUARIO||' '||K.APE_PATERNO||' '||K.APE_MATERNO USUARIONOMBRE, A.N_IDEXPEDIENTE
FROM SID_REG_EXPEDIENTE A 
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO
LEFT JOIN SID_REG_EXPEDE_ENTIDAD N ON N.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
LEFT JOIN SID_REG_ENTIDAD M ON M.N_ID_ENTIDAD = N.N_ID_ENTIDAD 
LEFT JOIN SID_REG_EXPEDIENTE_CLASI O ON O.C_NUMEROEXPEDIENTE = A.C_NUMEROEXPEDIENTE
LEFT JOIN SID_REG_EXPEDE_PERSONA P ON P.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
LEFT JOIN SID_REG_PERSONA Q ON Q.N_IDPERSONA = P.N_IDPERSONA
WHERE A.C_ESTADO = 'A' 
<if test="fechaIngresoDesde != null">
    AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaIngresoDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaIngresoHastaString})+1 
</if>
<if test="fechaConclusionDesde != null">
    AND A.C_ESTADOGENERAL = 'C' AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaConclusionDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaConclusionHastaString})+1 
</if>
<if test="tipoExpediente != ''">
    AND A.C_TIPOCLASIFICACION = #{tipoExpediente}
</if>
<if test="codigoEntidad != null">
    AND N.N_ID_ENTIDAD = #{codigoEntidad}
</if>
<if test="idDepartamentoEntidad != ''">
    AND M.C_IDDEPARTAMENTO = #{idDepartamentoEntidad}
</if>
<if test="canalIngreso != ''">
    AND A.C_TIPOINGRESO = #{canalIngreso}
</if>
<if test="ODBusqueda != ''">
    AND J.N_ID_OD = #{ODBusqueda}
</if>
<if test="usuarioCodigo != ''">
    AND K.CODIGO_USUARIO = #{usuarioCodigo}
</if>
<if test="gruposVulnerables != null">
    AND A.C_TIPOGRUPOVULNERABLE  IN
            <foreach item="item" index="index" collection="gruposVulnerables"
           open="(" separator="," close=")">
                #{item}
            </foreach>
</if>
<if test="etiqueta != ''">
    AND A.C_ETIQUETA = #{etiqueta}
</if>
<if test="idPrimerNivel != 0">
    AND O.N_ID_PRIMERNIVEL = #{idPrimerNivel}
</if>
<if test="idSegundoNivel != 0">
    AND O.N_ID_SEGUNDONIVEL = #{idSegundoNivel}
</if>
<if test="idTercerNivel != 0">
    AND O.N_ID_TERCERNIVEL = #{idTercerNivel}
</if>
<if test="idCuartoNivel != 0">
    AND O.N_ID_CUARTONIVEL = #{idCuartoNivel}
</if>
<if test="idQuintoNivel != 0">
    AND O.N_ID_QUINTONIVEL = #{idQuintoNivel}
</if>
<if test="idSextoNivel != 0">
    AND O.N_ID_SEXTONIVEL = #{idSextoNivel}
</if>

<if test="idDepartamentoRecurrente != ''">
    AND Q.C_IDDEPA = #{idDepartamentoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="idProvinciaRecurrente != ''">
    AND Q.C_IDPROV = #{idProvinciaRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="idDistritoRecurrente != ''">
    AND Q.C_IDDISTR = #{idDistritoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="esDiscapacitadoRecurrente != ''">
    AND Q.C_INDDISCAPACITADO = #{esDiscapacitadoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="tipoLenguaRecurrente != ''">
    AND Q.C_TIPOLENGUA = #{tipoLenguaRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="tipoPuebloRecurrente != ''">
    AND Q.C_TIPOPUEBLO = #{tipoPuebloRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>

<if test="idDepartamentoAfectado != ''">
    AND Q.C_IDDEPA = #{idDepartamentoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="idProvinciaAfectado != ''">
    AND Q.C_IDPROV = #{idProvinciaAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="idDistritoAfectado != ''">
    AND Q.C_IDDISTR = #{idDistritoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="esDiscapacitadoAfectado != ''">
    AND Q.C_INDDISCAPACITADO = #{esDiscapacitadoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="tipoLenguaAfectado != ''">
    AND Q.C_TIPOLENGUA = #{tipoLenguaAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="tipoPuebloAfectado != ''">
    AND Q.C_TIPOPUEBLO = #{tipoPuebloAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
ORDER BY A.N_IDEXPEDIENTE DESC
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select>
    
    
    
   <select id="listaGestionReporte" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
       SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
         SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, X.D_FECHA, X.C_CODIGOGESTION, M.C_NOMENTIDAD, 
            X.C_DESCRIPCION, X.D_FECHAREGISTRO, X.D_FECHAMODIFICACION, X.C_RESPUESTA,  X.D_FECHARESPUESTA, X.C_CODIGOGESTIONORIGEN
FROM SID_REG_EXPEDIENTE A
INNER JOIN SID_REG_GESTION_ETAPA Y ON A.C_NUMEROEXPEDIENTE = Y.C_NUMEROEXPEDIENTE
INNER JOIN SID_REG_GESTION X ON X.N_ID_GESTION = Y.N_ID_GESTION
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO 
LEFT JOIN SID_REG_ENTIDAD M ON M.N_ID_ENTIDAD =X.N_IDENTIDAD 
LEFT JOIN SID_REG_EXPEDIENTE_CLASI O ON O.C_NUMEROEXPEDIENTE = A.C_NUMEROEXPEDIENTE
LEFT JOIN SID_REG_EXPEDE_PERSONA P ON P.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
LEFT JOIN SID_REG_PERSONA Q ON Q.N_IDPERSONA = P.N_IDPERSONA
WHERE A.C_ESTADO = 'A'
       <if test="fechaIngresoDesde != null">
    AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaIngresoDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaIngresoHastaString})+1 
</if>
<if test="fechaConclusionDesde != null">
    AND A.C_ESTADOGENERAL = 'C' AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaConclusionDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaConclusionHastaString})+1 
</if>
<if test="tipoExpediente != ''">
    AND A.C_TIPOCLASIFICACION = #{tipoExpediente}
</if>
<if test="codigoEntidad != null">
    AND N.N_ID_ENTIDAD = #{codigoEntidad}
</if>
<if test="idDepartamentoEntidad != ''">
    AND M.C_IDDEPARTAMENTO = #{idDepartamentoEntidad}
</if>
<if test="canalIngreso != ''">
    AND A.C_TIPOINGRESO = #{canalIngreso}
</if>
<if test="ODBusqueda != ''">
    AND J.N_ID_OD = #{ODBusqueda}
</if>
<if test="usuarioCodigo != ''">
    AND K.CODIGO_USUARIO = #{usuarioCodigo}
</if>
<if test="gruposVulnerables != null">
    AND A.C_TIPOGRUPOVULNERABLE  IN
            <foreach item="item" index="index" collection="gruposVulnerables"
           open="(" separator="," close=")">
                #{item}
            </foreach>
</if>
<if test="etiqueta != ''">
    AND A.C_ETIQUETA = #{etiqueta}
</if>
<if test="idPrimerNivel != 0">
    AND O.N_ID_PRIMERNIVEL = #{idPrimerNivel}
</if>
<if test="idSegundoNivel != 0">
    AND O.N_ID_SEGUNDONIVEL = #{idSegundoNivel}
</if>
<if test="idTercerNivel != 0">
    AND O.N_ID_TERCERNIVEL = #{idTercerNivel}
</if>
<if test="idCuartoNivel != 0">
    AND O.N_ID_CUARTONIVEL = #{idCuartoNivel}
</if>
<if test="idQuintoNivel != 0">
    AND O.N_ID_QUINTONIVEL = #{idQuintoNivel}
</if>
<if test="idSextoNivel != 0">
    AND O.N_ID_SEXTONIVEL = #{idSextoNivel}
</if>

<if test="idDepartamentoRecurrente != ''">
    AND Q.C_IDDEPA = #{idDepartamentoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="idProvinciaRecurrente != ''">
    AND Q.C_IDPROV = #{idProvinciaRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="idDistritoRecurrente != ''">
    AND Q.C_IDDISTR = #{idDistritoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="esDiscapacitadoRecurrente != ''">
    AND Q.C_INDDISCAPACITADO = #{esDiscapacitadoRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="tipoLenguaRecurrente != ''">
    AND Q.C_TIPOLENGUA = #{tipoLenguaRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>
<if test="tipoPuebloRecurrente != ''">
    AND Q.C_TIPOPUEBLO = #{tipoPuebloRecurrente} 
    AND P.C_TIPO IN ('01','03')
</if>

<if test="idDepartamentoAfectado != ''">
    AND Q.C_IDDEPA = #{idDepartamentoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="idProvinciaAfectado != ''">
    AND Q.C_IDPROV = #{idProvinciaAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="idDistritoAfectado != ''">
    AND Q.C_IDDISTR = #{idDistritoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="esDiscapacitadoAfectado != ''">
    AND Q.C_INDDISCAPACITADO = #{esDiscapacitadoAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="tipoLenguaAfectado != ''">
    AND Q.C_TIPOLENGUA = #{tipoLenguaAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
<if test="tipoPuebloAfectado != ''">
    AND Q.C_TIPOPUEBLO = #{tipoPuebloAfectado} 
    AND P.C_TIPO IN ('02','03')
</if>
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select> 
    
    
    <select id="listaEntidadReporte" resultMap="reporteSidConteoMap" parameterType="reporteSidExpediente">
        SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
        SELECT COUNT(DISTINCT Z.N_IDEXPEDIENTE) TOTAL, COUNT(DISTINCT B.N_IDEXPEDIENTE) TOTAL_QUEJA, COUNT(DISTINCT C.N_IDEXPEDIENTE) TOTAL_QUEJA_TRAMITE, COUNT(DISTINCT D.N_IDEXPEDIENTE) TOTAL_QUEJA_CONCLUIDO,
COUNT(DISTINCT E.N_IDEXPEDIENTE) TOTAL_QUEJA_CONCLUIDO_FUNDADO, COUNT(DISTINCT F.N_IDEXPEDIENTE) Q_CONCLUIDO_FUNDADO_ACOGIDO, COUNT(DISTINCT G.N_IDEXPEDIENTE) Q_FUNDADO_ACOGIDOPAR_ACOGIDO, COUNT(DISTINCT H.N_IDEXPEDIENTE) Q_FUNDA_ACOGIDOPAR_ACOGIDOPAR, 
COUNT(DISTINCT I.N_IDEXPEDIENTE) Q_FUNDADO_ACOGIDOPAR_NOACOGIDO, COUNT(DISTINCT J.N_IDEXPEDIENTE) Q_FUNDADO_NOACOGIDOP_ACOGIDO, COUNT(DISTINCT K.N_IDEXPEDIENTE) Q_FUNDADO_NOACOGIDO_ACOGIDOPAR, COUNT(DISTINCT L.N_IDEXPEDIENTE) Q_FUNDADO_NOACOGIDO_NOACOGIDO,
COUNT(DISTINCT M.N_IDEXPEDIENTE) TOTAL_PETITORIO, COUNT(DISTINCT N.N_IDEXPEDIENTE) TOTAL_PETITORIO_TRAMITE, COUNT(DISTINCT O.N_IDEXPEDIENTE) TOTAL_PETITORIO_CONCLUIDO, COUNT(DISTINCT P.N_IDEXPEDIENTE) TOTAL_PET_CONCLUIDO_ACO, COUNT(DISTINCT Q.N_IDEXPEDIENTE) TOTAL_PET_CONCLUIDO_NACO,
COUNT(DISTINCT R.N_ID_GESTION) TOTAL_GESTION, COUNT(DISTINCT S.N_ID_GESTION) TOTAL_GESTION_SI, COUNT(DISTINCT T.N_ID_GESTION) TOTAL_GESTION_NO, 
A.C_NOMENTIDAD, X.C_DESCDPTO
FROM SID_REG_ENTIDAD A
INNER JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_ESTADO = 'A') Z
ON A.N_ID_ENTIDAD = Z.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A') B
ON A.N_ID_ENTIDAD = B.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'A') C
ON A.N_ID_ENTIDAD = C.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C') D
ON A.N_ID_ENTIDAD = D.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3) E
ON A.N_ID_ENTIDAD = E.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 5 AND A1.C_ESTADOSEGUIMIENTO IS NULL) F
ON A.N_ID_ENTIDAD = F.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 17 AND A1.C_ESTADOSEGUIMIENTO = 7) G
ON A.N_ID_ENTIDAD = G.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 17 AND A1.C_ESTADOSEGUIMIENTO = 18) H
ON A.N_ID_ENTIDAD = H.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 17 AND A1.C_ESTADOSEGUIMIENTO = 8) I
ON A.N_ID_ENTIDAD = I.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 6 AND A1.C_ESTADOSEGUIMIENTO = 7) J
ON A.N_ID_ENTIDAD = J.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 6 AND A1.C_ESTADOSEGUIMIENTO = 18) K
ON A.N_ID_ENTIDAD = K.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOINVESTIGACION = 3 AND A1.C_ESTADOPERSUACION = 6 AND A1.C_ESTADOSEGUIMIENTO = 8) L
ON A.N_ID_ENTIDAD = L.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '03' AND A1.C_ESTADO = 'A') M
ON A.N_ID_ENTIDAD = M.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '03' AND A1.C_ESTADO = 'A' AND C_ESTADOGENERAL = 'A') N
ON A.N_ID_ENTIDAD = N.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '03' AND A1.C_ESTADO = 'A' AND C_ESTADOGENERAL = 'C') O
ON A.N_ID_ENTIDAD = O.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOGESTION = 12 AND A1.C_ESTADOPERSUACION = 6 AND A1.C_ESTADOSEGUIMIENTO = 14) P
ON A.N_ID_ENTIDAD = P.N_ID_ENTIDAD
LEFT JOIN (SELECT A1.N_IDEXPEDIENTE, B1.N_ID_ENTIDAD FROM SID_REG_EXPEDIENTE A1 INNER JOIN SID_REG_EXPEDE_ENTIDAD B1 ON A1.N_IDEXPEDIENTE = B1.N_IDEXPEDIENTE  WHERE A1.C_TIPOCLASIFICACION = '01' AND A1.C_ESTADO = 'A' AND A1.C_ESTADOGENERAL = 'C' AND A1.C_ESTADOGESTION = 12 AND A1.C_ESTADOPERSUACION = 6 AND A1.C_ESTADOSEGUIMIENTO = 15) Q
ON A.N_ID_ENTIDAD = Q.N_ID_ENTIDAD
LEFT JOIN SID_REG_GESTION R ON A.N_ID_ENTIDAD = R.N_IDENTIDAD
LEFT JOIN (SELECT N_ID_GESTION, N_IDENTIDAD FROM SID_REG_GESTION WHERE C_RESPUESTA = 'SI') S ON A.N_ID_ENTIDAD = S.N_IDENTIDAD
LEFT JOIN (SELECT N_ID_GESTION, N_IDENTIDAD FROM SID_REG_GESTION WHERE C_RESPUESTA = 'NO') T ON A.N_ID_ENTIDAD = T.N_IDENTIDAD
LEFT JOIN SID_UBIGEO_DPTO X ON A.C_IDDEPARTAMENTO = X.C_ID_DPTO
GROUP BY A.C_NOMENTIDAD, X.C_DESCDPTO
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select>
    
    
    <select id="listaExpedienteReporteExport" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
       
        SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, A.D_FECHAREGISTRO, C.NOMBRE_PARAMETRO CANALINGRESO, E.C_VALOR ETAPAEXPEDIENTE, F.C_NOMBRE ESTADOCALIFICACION, 
G.C_NOMBRE ESTADOINVESTIGACION, H.C_NOMBRE ESTADOPERSUACION, I.C_NOMBRE ESTADOSEGUIMIENTO, A.C_TIPOGRUPOVULNERABLE, A.C_ETIQUETA,
CASE WHEN C_ESTADOGENERAL = 'A' THEN 'Tr√°mite' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO IS NULL THEN 'Concluido' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO = 1 THEN 'Desistido' END ESTADOGENERAL,
CASE N_VERSION WHEN 0 THEN 'Borrador' ELSE 'En registro' END ESTADOREGISTRO, A.C_SUMILLA, J.C_NOMBRE OD, A.D_FECHAINGRESO, A.C_USUREGISTRO, K.NOM_USUARIO||' '||K.APE_PATERNO||' '||K.APE_MATERNO USUARIONOMBRE, A.N_IDEXPEDIENTE
FROM SID_REG_EXPEDIENTE A 
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO
LEFT JOIN SID_REG_EXPEDE_ENTIDAD N ON N.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
LEFT JOIN SID_REG_ENTIDAD M ON M.N_ID_ENTIDAD = N.N_ID_ENTIDAD 
LEFT JOIN SID_REG_EXPEDIENTE_CLASI O ON O.C_NUMEROEXPEDIENTE = A.C_NUMEROEXPEDIENTE
WHERE A.C_ESTADO = 'A' 
<if test="fechaIngresoDesde != null">
    AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaIngresoDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAINGRESO, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaIngresoHastaString})+1 
</if>
<if test="fechaConclusionDesde != null">
    AND A.C_ESTADOGENERAL = 'C' AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &gt; TO_NUMBER(#{fechaConclusionDesdeString})-1 AND TO_NUMBER(TO_CHAR(A.D_FECHAMODIFICACION, 'YYYYMMDD')) &lt; TO_NUMBER(#{fechaConclusionHastaString})+1 
</if>
<if test="tipoExpediente != ''">
    AND A.C_TIPOCLASIFICACION = #{tipoExpediente}
</if>
<if test="codigoEntidad != null">
    AND N.N_ID_ENTIDAD = #{codigoEntidad}
</if>
<if test="idDepartamentoEntidad != ''">
    AND M.C_IDDEPARTAMENTO = #{idDepartamentoEntidad}
</if>
<if test="canalIngreso != ''">
    AND A.C_TIPOINGRESO = #{canalIngreso}
</if>
<if test="ODBusqueda != ''">
    AND J.N_ID_OD = #{ODBusqueda}
</if>
<if test="usuarioCodigo != ''">
    AND K.CODIGO_USUARIO = #{usuarioCodigo}
</if>
<if test="gruposVulnerables != null">
    AND A.C_TIPOGRUPOVULNERABLE  IN
            <foreach item="item" index="index" collection="gruposVulnerables"
           open="(" separator="," close=")">
                #{item}
            </foreach>
</if>
ORDER BY A.N_IDEXPEDIENTE DESC
        
    </select>
    
    
    <select id="listaExpedienteReporteClasificacion" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
        SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
        SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, A.D_FECHAREGISTRO, C.NOMBRE_PARAMETRO CANALINGRESO, E.C_VALOR ETAPAEXPEDIENTE, F.C_NOMBRE ESTADOCALIFICACION, 
G.C_NOMBRE ESTADOINVESTIGACION, H.C_NOMBRE ESTADOPERSUACION, I.C_NOMBRE ESTADOSEGUIMIENTO, 
CASE WHEN C_ESTADOGENERAL = 'A' THEN 'Tr√°mite' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO IS NULL THEN 'Concluido' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO = 1 THEN 'Desistido' END ESTADOGENERAL,
CASE N_VERSION WHEN 0 THEN 'Borrador' ELSE 'En registro' END ESTADOREGISTRO, A.C_SUMILLA, J.C_NOMBRE OD, A.D_FECHAINGRESO, A.C_USUREGISTRO, K.NOM_USUARIO||' '||K.APE_PATERNO||' '||K.APE_MATERNO USUARIONOMBRE, A.N_IDEXPEDIENTE
FROM SID_REG_EXPEDIENTE A 
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO
LEFT JOIN SID_REG_EXPEDE_ENTIDAD N ON N.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
LEFT JOIN SID_REG_ENTIDAD M ON M.N_ID_ENTIDAD = N.N_ID_ENTIDAD 
INNER JOIN SID_REG_EXPEDIENTE_CLASI O ON O.C_NUMEROEXPEDIENTE = A.C_NUMEROEXPEDIENTE AND O.C_ESTADO = 'ACT'
WHERE A.C_ESTADO = 'A' 
<if test="idPrimerNivel != 0">
    AND O.N_ID_PRIMERNIVEL = #{idPrimerNivel}
</if>
<if test="idSegundoNivel != 0">
    AND O.N_ID_SEGUNDONIVEL = #{idSegundoNivel}
</if>
<if test="idTercerNivel != 0">
    AND O.N_ID_TERCERNIVEL = #{idTercerNivel}
</if>
<if test="idCuartoNivel != 0">
    AND O.N_ID_CUARTONIVEL = #{idCuartoNivel}
</if>
<if test="idQuintoNivel != 0">
    AND O.N_ID_QUINTONIVEL = #{idQuintoNivel}
</if>
<if test="idSextoNivel != 0">
    AND O.N_ID_SEXTONIVEL = #{idSextoNivel}
</if>
ORDER BY A.N_IDEXPEDIENTE DESC
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select>
    
    
  <select id="listaExpedienteReporteRecurrente" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
        SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
        SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, A.D_FECHAREGISTRO, C.NOMBRE_PARAMETRO CANALINGRESO, E.C_VALOR ETAPAEXPEDIENTE, F.C_NOMBRE ESTADOCALIFICACION, 
G.C_NOMBRE ESTADOINVESTIGACION, H.C_NOMBRE ESTADOPERSUACION, I.C_NOMBRE ESTADOSEGUIMIENTO, 
CASE WHEN C_ESTADOGENERAL = 'A' THEN 'Tr√°mite' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO IS NULL THEN 'Concluido' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO = 1 THEN 'Desistido' END ESTADOGENERAL,
CASE N_VERSION WHEN 0 THEN 'Borrador' ELSE 'En registro' END ESTADOREGISTRO, A.C_SUMILLA, J.C_NOMBRE OD, A.D_FECHAINGRESO, A.C_USUREGISTRO, K.NOM_USUARIO||' '||K.APE_PATERNO||' '||K.APE_MATERNO USUARIONOMBRE, A.N_IDEXPEDIENTE
FROM SID_REG_EXPEDIENTE A 
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO
INNER JOIN SID_REG_EXPEDE_PERSONA N ON N.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
INNER JOIN SID_REG_PERSONA M ON M.N_IDPERSONA = N.N_IDPERSONA
WHERE A.C_ESTADO = 'A' AND N.C_TIPO IN ('01','03')
<if test="idDepartamentoRecurrente != ''">
    AND M.C_IDDEPA = #{idDepartamentoRecurrente} 
</if>
<if test="idProvinciaRecurrente != ''">
    AND M.C_IDPROV = #{idProvinciaRecurrente} 
</if>
<if test="idDistritoRecurrente != ''">
    AND M.C_IDDISTR = #{idDistritoRecurrente} 
</if>
<if test="esDiscapacitadoRecurrente != ''">
    AND M.C_INDDISCAPACITADO = #{esDiscapacitadoRecurrente} 
</if>
<if test="tipoLenguaRecurrente != ''">
    AND M.C_TIPOLENGUA = #{tipoLenguaRecurrente} 
</if>
<if test="tipoPuebloRecurrente != ''">
    AND M.C_TIPOPUEBLO = #{tipoPuebloRecurrente} 
</if>
ORDER BY A.N_IDEXPEDIENTE DESC
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select>  
    
    
    <select id="listaExpedienteReporteAfectado" resultMap="reporteSidExpedienteMap" parameterType="reporteSidExpediente">
        SELECT A.*
        FROM (
        SELECT
        B.*,
        ROWNUM numfila
        FROM (
        SELECT DISTINCT A.C_NUMEROEXPEDIENTE, B.NOMBRE_PARAMETRO TIPOEXPEDIENTE, A.D_FECHAREGISTRO, C.NOMBRE_PARAMETRO CANALINGRESO, E.C_VALOR ETAPAEXPEDIENTE, F.C_NOMBRE ESTADOCALIFICACION, 
G.C_NOMBRE ESTADOINVESTIGACION, H.C_NOMBRE ESTADOPERSUACION, I.C_NOMBRE ESTADOSEGUIMIENTO, 
CASE WHEN C_ESTADOGENERAL = 'A' THEN 'Tr√°mite' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO IS NULL THEN 'Concluido' WHEN C_ESTADOGENERAL = 'C' AND N_INDDESESTIMIENTO = 1 THEN 'Desistido' END ESTADOGENERAL,
CASE N_VERSION WHEN 0 THEN 'Borrador' ELSE 'En registro' END ESTADOREGISTRO, A.C_SUMILLA, J.C_NOMBRE OD, A.D_FECHAINGRESO, A.C_USUREGISTRO, K.NOM_USUARIO||' '||K.APE_PATERNO||' '||K.APE_MATERNO USUARIONOMBRE, A.N_IDEXPEDIENTE
FROM SID_REG_EXPEDIENTE A 
LEFT JOIN SID_PARAMETRO B ON A.C_TIPOCLASIFICACION = B.VALOR_PARAMETRO AND B.PADRE_PARAMETRO = 10
LEFT JOIN SID_PARAMETRO C ON A.C_TIPOINGRESO = C.VALOR_PARAMETRO AND C.PADRE_PARAMETRO = 20
LEFT JOIN SID_REG_ETAPA_ESTADO D ON A.N_IDEXPEDIENTE = D.N_ID_EXPEDIENTE AND D.C_INDICADOR = 'ACT'
LEFT JOIN SID_REG_ETAPA E ON D.N_ID_ETAPA = E.N_ID_ETAPA
LEFT JOIN SID_REG_ESTADO F ON F.N_ID_ESTADO = A.C_ESTADOCALIFICACION
LEFT JOIN SID_REG_ESTADO G ON G.N_ID_ESTADO = A.C_ESTADOINVESTIGACION
LEFT JOIN SID_REG_ESTADO H ON H.N_ID_ESTADO = A.C_ESTADOPERSUACION
LEFT JOIN SID_REG_ESTADO I ON I.N_ID_ESTADO = A.C_ESTADOSEGUIMIENTO
LEFT JOIN SID_SEG_OFICINA_DEFENSORIAL J ON A.N_CODIGOOD = J.N_ID_OD
INNER JOIN SID_SEG_USUARIO K ON A.C_USUREGISTRO = K.CODIGO_USUARIO
INNER JOIN SID_REG_EXPEDE_PERSONA N ON N.N_IDEXPEDIENTE = A.N_IDEXPEDIENTE      
INNER JOIN SID_REG_PERSONA M ON M.N_IDPERSONA = N.N_IDPERSONA
WHERE A.C_ESTADO = 'A' AND N.C_TIPO IN ('02','03')
<if test="idDepartamentoAfectado != ''">
    AND M.C_IDDEPA = #{idDepartamentoAfectado} 
</if>
<if test="idProvinciaAfectado != ''">
    AND M.C_IDPROV = #{idProvinciaAfectado} 
</if>
<if test="idDistritoAfectado != ''">
    AND M.C_IDDISTR = #{idDistritoAfectado} 
</if>
<if test="esDiscapacitadoAfectado != ''">
    AND M.C_INDDISCAPACITADO = #{esDiscapacitadoAfectado} 
</if>
<if test="tipoLenguaAfectado != ''">
    AND M.C_TIPOLENGUA = #{tipoLenguaAfectado} 
</if>
<if test="tipoPuebloAfectado != ''">
    AND M.C_TIPOPUEBLO = #{tipoPuebloAfectado} 
</if>
ORDER BY A.N_IDEXPEDIENTE DESC
        ) B
        ) A WHERE a.numfila BETWEEN #{ini} AND #{fin}
    </select>  
    
    
   
    
    
</mapper>